<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mining RNG Simulator</title>
    <style>
        body {
            margin: 0;
            background: #111;
            color: white;
            font-family: Arial;
            display: flex;
            flex-direction: column;
            align-items: center;
			overflow-x: hidden;
        }

        #game {
    background: #222;
    cursor: pointer;
    margin-top: 10px;
    margin-left: -100px; /* move 20px to the left */
    position: relative;
    z-index: 1;
}


        /* UI below the canvas */
        #ui {
            display: flex;
            width: 1280px;
            margin-top: 10px;
        }

        #pickaxeUI, #gearUI, #artefactUI, #luckArtefactUI {
            width: 320px;
            padding: 10px;
            background: #181818;
            overflow-y: auto;
            height: 250px;
            margin-right: 10px;
            border-radius: 8px;
        }

        #inventory {
            width: 960px;
            padding: 10px;
            background: #181818;
            overflow-y: auto;
            height: 150px;
            margin-top: 10px;
            border-radius: 8px;
        }

        /* Buttons styling */
        button {
            width: 100%;
            margin-top: 4px;
            padding: 6px;
            background: #333;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        button:hover {
            background: #444;
        }

        /* Save/Reset buttons */
        #saveReset {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 10px;
            z-index: 50;
        }

        #recentFind {
    position: absolute;
    top: 10px;                     
    left: 1100px;                  
    width: 350px;

    /* Make it taller to fit 5 ore items */
    height: auto;           /* allow content to define height */
    max-height: 240px;      /* limit maximum height */
    min-height: 240px;      /* optional: minimum starting height */

    background: #222;
    border: 2px solid #fff;
    border-radius: 10px;
    padding: 10px;
    color: white;
    font-family: Arial;
	text-align: center;
    margin: 0 0 10px 0;
    z-index: 10;
}
#recentFindContent {
    text-align: center;       /* centers text inside each ore div */
    display: flex;            /* make items flexible */
    flex-direction: column;   /* stack ores vertically */
    align-items: center;      /* horizontally center each ore */
    gap: 5px;                 /* optional: spacing between ores */
}


        /* Block counters top right */
        #blockCounters {
            position: absolute;
            top: 10px;
            right: 10px;
            text-align: right;
            color: white;
            font-family: Arial;
            z-index: 50;
        }

        /* Spawn message overlay */
        #spawnMessage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85);
            padding: 25px 50px;
            border-radius: 15px;
            font-size: 26px;
            font-weight: bold;
            text-align: center;
            display: none;
            z-index: 9999;
        }

        /* Spawn effect overlay */
        #spawnEffect {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: transparent;
            pointer-events: none;
            z-index: 9998;
            transition: background 5s linear;
        }

        @keyframes imaginaryPulseAnim {
            0%   { transform: translate(-50%, -50%) scale(1.5); }
            50%  { transform: translate(-50%, -50%) scale(2.3); }
            100% { transform: translate(-50%, -50%) scale(1.5); }
        }

        /* Ore Index and Inventory wrapper */
        #bottomPanels {
            display: flex;
            width: 1280px;
            margin-top: 10px;
            gap: 10px;
        }

        #oreIndex, #inventory {
            padding: 10px;
            background: #181818;
            overflow-y: auto;
            border-radius: 8px;
            color: white;
        }

        #oreIndex {
            width: 400px;
            height: 150px;
        }

        #inventory {
            width: 900px;
            height: 150px;
        }

        /* Ore Viewer panel */
        #oreViewer {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 200px;
            height: 200px;
            background:#222;
            border:2px solid #fff;
            border-radius:10px;
            display:none;
            text-align:center;
            padding:10px;
            color:white;
        }

        #oreBlock {
            width:100%;
            height:120px;
            margin-bottom:10px;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:50px;
        }

        #oreName {
            font-weight:bold;
            font-size:16px;
        }

        #oreRarity {
            margin-bottom:10px;
        }

        #replaySpawn {
            padding:6px;
            width:100%;
        }

    </style>
</head>
<body>

    <div id="saveReset">
        <button onclick="saveGame()">Save</button>
        <button onclick="resetGame()">Reset</button>
        <button id="sortToggle" onclick="toggleSort()">Sort: Common ‚Üí Rarest</button>
        <button id="compactToggle" onclick="toggleCompact()">Compact: Off</button>
		<button id="volumeToggle" onclick="toggleVolume()">Volume: 100%</button>
    </div>

    <div id="spawnEffect"></div>

    <!-- Canvas -->
    <canvas id="game" width="270" height="270"></canvas>

    <!-- Recent Finds -->
    <div id="recentFind">
        <h3>Recent Finds</h3>
        <div id="recentFindContent"></div>
    </div>

    <!-- Main UI panels -->
    <div id="ui">
        <div id="pickaxeUI"><h3>Pickaxes</h3></div>
        <div id="gearUI"><h3>Gear</h3></div>
        <div id="artefactUI"><h3>Auto-Miner Artefact</h3></div>
        <div id="luckArtefactUI"><h3>Luck Artefact</h3></div>
    </div>

    <!-- Block counters -->
    <div id="blockCounters">
        <div id="totalMined">Total Mined: 0</div>
        <div id="globalMined">Global Mined: 0</div>
    </div>

    <!-- Bottom panels -->
    <div id="bottomPanels">
        <div id="oreIndex">
            <h3>Ore Index</h3>
        </div>
        <div id="inventory">
            <h3>Inventory</h3>
        </div>
    </div>

    <!-- Ore Viewer -->
    <div id="oreViewer">
        <div id="oreBlock"></div>
        <div id="oreName"></div>
        <div id="oreRarity"></div>
        <button id="replaySpawn">Replay Spawn Message & Sound</button>
    </div>

    <!-- Spawn Message -->
    <div id="spawnMessage"></div>

    <!-- Audio -->
    <audio id="Achillgoesdownyourspine" src="Achillgoesdownyourspine.mp3" preload="auto"></audio>
    <audio id="Yourheartskipsabeat" src="Yourheartskipsabeat.mp3" preload="auto"></audio>
    <audio id="Transcendent" src="Transcendent.mp3" preload="auto"></audio>
    <audio id="Enigmatic" src="Enigmatic.mp3" preload="auto"></audio>
    <audio id="Unfathomable" src="Unfathomable.mp3" preload="auto"></audio>
    <audio id="Otherworldly" src="Otherworldly.mp3" preload="auto"></audio>
    <audio id="Imaginary" src="Imaginary.mp3" preload="auto"></audio>
    <audio id="Zenith" src="Zenith.mp3"></audio>
    <audio id="Eternal" src="Eternal.mp3"></audio>

</body>

<script>
        // Unlock audio on first click
        document.body.addEventListener("click", () => {
            audioEnabled = true;
        });

        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        const SIZE = 90;
        const GRID = 3;

        let grid = [];
        let inventory = {};
        let ownedPickaxes = ["T0"];
        let equippedPickaxe = "T0";
        let ownedGears = [];
        let equippedGears = [];
        let artefactLevel = 0;
        let luckArtefactLevel = 0;
        let pauseOnChill = false;
        let waitingForManualHighOre = false;
        let totalBlocksMined = 0;
        let globalBlocksMined = 0;
        let artefactInterval = null;
        let sortRarestFirst = false; // false = Common ‚Üí Rarest, true = Rarest ‚Üí Common
        let audioEnabled = false;
        let spawnLock = false;
		let compactNumbers = false;
		let recentFinds = [];
		let volumeLevels = [1, 0.75, 0.5, 0.25, 0.05, 0];
		let currentVolumeIndex = 0;

		
		function toggleCompact() {
			compactNumbers = !compactNumbers;
			document.getElementById("compactToggle").innerText = 
				`Compact: ${compactNumbers ? "On" : "Off"}`;
			updateCounters();
			updateUI();
		}

// Helper to format numbers compactly
	function formatNumber(n) {
		if (!compactNumbers) return n.toLocaleString();
		if (n >= 1e15) return (n / 1e15).toFixed(2) + "QD"; // Quadrillion
		if (n >= 1e12) return (n / 1e12).toFixed(2) + "T";  // Trillion
		if (n >= 1e9)  return (n / 1e9).toFixed(2) + "B";   // Billion
		if (n >= 1e6)  return (n / 1e6).toFixed(2) + "M";   // Million
		if (n >= 1e3)  return (n / 1e3).toFixed(1) + "K";   // Thousand
		return n.toString();
	}
	function toggleVolume() {
    currentVolumeIndex++;
    if (currentVolumeIndex >= volumeLevels.length) {
        currentVolumeIndex = 0;
    }

    const volume = volumeLevels[currentVolumeIndex];

    document.getElementById("volumeToggle").innerText =
        "Volume: " + Math.round(volume * 100) + "%";

    // Apply volume to ALL audio elements
    document.querySelectorAll("audio").forEach(a => {
        a.volume = volume;
    });
}
	
        function playSpawnSound(ore) {
    if (spawnLock) return;

    const data = oreData[ore];
    if (!data.spawnMsg) return;

    spawnLock = true;

    const msgDiv = document.getElementById("spawnMessage");
    msgDiv.innerText = data.spawnMsg;
    msgDiv.style.color = rarityColors[data.rarity] || "#ffffff";
    msgDiv.style.display = "block";

    let audioId = null;
    const exact = data.exact;

    if (exact >= 250000 && exact < 10000000) audioId = "Achillgoesdownyourspine";
    else if (exact >= 10000000 && exact < 25000000) audioId = "Yourheartskipsabeat";
    else if (exact >= 25000000 && exact < 60000000) audioId = "Transcendent";
    else if (exact >= 60000000 && exact < 100000000) audioId = "Enigmatic";
    else if (exact >= 100000000 && exact < 251000000) audioId = "Unfathomable";
    else if (exact >= 251000000 && exact < 1000000000) audioId = "Otherworldly";
    else if (exact >= 1000000000 && exact < 50000000000) audioId = "Imaginary";
    else if (exact >= 50000000000 && exact < 1000000000000) audioId = "Zenith";
    else if (exact >= 1000000000000) audioId = "Eternal";

    function unlock() {
        msgDiv.style.display = "none";
        spawnLock = false;
    }

    if (!audioEnabled || !audioId) {
        setTimeout(unlock, 5000);
        return;
    }

    const audio = document.getElementById(audioId);
    audio.pause();
    audio.currentTime = 0;

    audio.play().then(() => {

        /* =========================
           üî• ETERNAL EFFECT
        ========================== */
        if (data.rarity === "Eternal") {

            const overlay = document.getElementById("spawnEffect");

            overlay.style.transition = "background 0s linear";
            overlay.style.background = "transparent";

            setTimeout(() => {
                overlay.style.transition = "background 5s linear";
                overlay.style.background = "white";
            }, 50);

            setTimeout(() => {
                overlay.style.transition = "background 5s linear";
                overlay.style.background = "rgba(100,100,100,0.7)";
            }, 5050);

            audio.onended = () => {
                overlay.style.transition = "background 1s linear";
                overlay.style.background = "transparent";
                unlock();
            };

            return;
        }

        /* =========================
           üåå ZENITH EFFECT
        ========================== */
        if (data.rarity === "Zenith") {

            const numDivs = 5;
            const spawnDivs = [];

            function isOverlapping(x, y, size = 150) {
                return spawnDivs.some(d =>
                    Math.abs(d.x - x) < size &&
                    Math.abs(d.y - y) < size
                );
            }

            for (let i = 0; i < numDivs; i++) {
                let x, y, attempts = 0;

                do {
                    x = Math.random() * (window.innerWidth - 200) + 50;
                    y = Math.random() * (window.innerHeight - 200) + 50;
                    attempts++;
                } while (isOverlapping(x, y) && attempts < 20);

                const div = document.createElement("div");
                div.innerText = data.spawnMsg;
                div.style.position = "fixed";
                div.style.left = x + "px";
                div.style.top = y + "px";
                div.style.fontSize = "24px";
                div.style.fontWeight = "bold";
                div.style.color = rarityColors["Zenith"];
                div.style.pointerEvents = "none";
                div.style.zIndex = 10000;

                document.body.appendChild(div);
                spawnDivs.push({ div, x, y });
            }

            let angle = 0;
            const spinInterval = setInterval(() => {
                angle += 5;
                spawnDivs.forEach(d =>
                    d.div.style.transform = `rotate(${angle}deg)`
                );
            }, 50);

            audio.onended = () => {
                clearInterval(spinInterval);
                spawnDivs.forEach(d => d.div.remove());
                unlock();
            };

            return;
        }
		/* =========================
   üå† IMAGINARY EFFECT (OVER CANVAS)
========================= */
if (data.rarity === "Imaginary") {

    const canvas = document.getElementById("game");

    const block = document.createElement("div");

    block.style.position = "absolute";
    block.style.top = canvas.offsetTop + canvas.height / 2 + "px";
    block.style.left = canvas.offsetLeft + canvas.width / 2 + "px";
    block.style.transform = "translate(-50%, -50%) scale(1.5)";
    block.style.width = "180px";
    block.style.height = "180px";
    block.style.background = data.color;
    block.style.display = "flex";
    block.style.alignItems = "center";
    block.style.justifyContent = "center";
    block.style.fontSize = "70px";
    block.style.fontWeight = "bold";
    block.style.color = data.symbolColor || "#fff";
    block.style.borderRadius = "20px";
    block.style.zIndex = "5";
    block.style.pointerEvents = "none";
    block.style.animation = "imaginaryPulseAnim 1.5s infinite ease-in-out";

    block.innerText = data.symbol || "";

    document.body.appendChild(block);

    audio.onended = () => {
        block.remove();
        unlock();
    };

    return;
}





        /* =========================
           NORMAL RARITIES
        ========================== */
        audio.onended = unlock;

    }).catch(() => {
        setTimeout(unlock, 5000);
    });
}

function updateRecentFind(ore) {
    const data = oreData[ore];

    if (data.exact < 250000) return; // only rare/high-tier ores

    // Add new find at the start
    recentFinds.unshift({
        name: ore,
        rarity: data.rarity,
        exact: data.exact,
        color: data.color,
        symbol: data.symbol || "",
        symbolColor: data.symbolColor || "#fff"
    });

    // Keep only 5 items
    recentFinds = recentFinds.slice(0, 5);

    // Update DOM
    const div = document.getElementById("recentFindContent");
    div.innerHTML = "";

    recentFinds.forEach(f => {
        const fDiv = document.createElement("div");
        fDiv.style.display = "flex";
        fDiv.style.alignItems = "center";
        fDiv.style.marginBottom = "6px";

        const colorBox = document.createElement("div");
        colorBox.style.width = "24px";
        colorBox.style.height = "24px";
        colorBox.style.background = f.color;
        colorBox.style.color = f.symbolColor;
        colorBox.style.display = "flex";
        colorBox.style.alignItems = "center";
        colorBox.style.justifyContent = "center";
        colorBox.style.fontWeight = "bold";
        colorBox.style.marginRight = "6px";
        colorBox.innerText = f.symbol;

        const text = document.createElement("div");
        text.innerText = `${f.name} (${f.rarity}) - 1 in ${formatNumber(f.exact)}`;
        text.style.fontSize = "14px";
        text.style.flex = "1";

        fDiv.appendChild(colorBox);
        fDiv.appendChild(text);
        div.appendChild(fDiv);
    });
}


      

        function toggleSort() {
            sortRarestFirst = !sortRarestFirst;
            document.getElementById("sortToggle").innerText =
                "Sort: " + (sortRarestFirst ? "Rarest ‚Üí Common" : "Common ‚Üí Rarest");
            updateUI(); // redraw inventory with new sorting
        }
// Ore Data
const oreData = {
    Stone:{rarity:"Common",value:1,color:"#777",exact:3},
    Coal:{rarity:"Common",value:2,color:"#444",exact:10},
    Iron:{rarity:"Uncommon",value:3,color:"#aaa",exact:20},
    Emerald:{rarity:"Rare",value:4,color:"#2ecc71",symbol:"E",exact:35},
    Ruby:{rarity:"Epic",value:5,color:"#e91e63",symbol:"R",exact:50},
    Sapphire:{rarity:"Legendary",value:6,color:"#2196f3",symbol:"S",exact:75},
    Topaz:{rarity:"Legendary",value:7,color:"#ff9800",symbol:"T",exact:100},
    Diamond:{rarity:"Legendary",value:8,color:"#00ffff",symbol:"D",exact:150},
    Void:{rarity:"Legendary",value:9,color:"#9c27b0",symbol:"V",exact:250},
    Gold:{rarity:"Legendary+",value:10,color:"#ffd700",symbol:"G",exact:1000},
    Mega:{rarity:"Legendary+",value:11,color:"#ff9800",symbol:"M",exact:10000},
    UltraMega:{rarity:"Mythic",value:12,color:"#ff5722",symbol:"U",exact:25000},
    HyperMega:{rarity:"Mythic",value:13,color:"#e91e63",symbol:"H",exact:50000},
    Giga:{rarity:"Mythical",value:14,color:"#2196f3",symbol:"G",exact:100000},
    Smiley:{rarity:"Exotic",value:15,color:"#ffeb3b",symbol:"üòä",spawnMsg:"A chill goes down your spine!",exact:250000},
    Tera:{rarity:"Exotic",value:16,color:"#9c27b0",symbol:"T",spawnMsg:"A chill goes down your spine!",exact:500000},
    TeraPlus:{rarity:"Exotic",value:17,color:"#ff4081",symbol:"TP",spawnMsg:"A chill goes down your spine!",exact:1000000},
    Peta:{rarity:"Exotic",value:18,color:"#00bcd4",symbol:"P",spawnMsg:"A chill goes down your spine!",exact:5000000},
    PetaPlus1:{rarity:"Exquisite",value:19,color:"#ff4081",symbol:"PP1",spawnMsg:"Your heart skips a beat!",exact:10000000},
    PetaPlus2:{rarity:"Transcendent",value:20,color:"#cddc39",symbol:"PP2",spawnMsg:"You hear a ringing!",exact:25000000},
    PetaPlus3:{rarity:"Transcendent",value:21,color:"#ff5722",symbol:"PP3",spawnMsg:"You hear a ringing!",exact:51000000},
    PetaPlus4:{rarity:"Enigmatic",value:22,color:"#00bcd4",symbol:"PP4",spawnMsg:"Your vision begins to blur!",exact:75000000},
    VoidPlus:{rarity:"Unfathomable",value:23,color:"#8e24aa",symbol:"VP",spawnMsg:"A ripple runs through the cosmos as you uncover the VoidPlus!",exact:250000000},
    VoidUltra:{rarity:"Otherworldly",value:24,color:"#000",symbol:"VU",spawnMsg:"The universe trembles! You've discovered the legendary VoidUltra!",exact:500000000},
    Infinity:{rarity:"Imaginary",value:25,color:"#000",symbol:"‚àû",symbolColor:"#fff",spawnMsg:"You feel the universe itself watching you!",exact:1000000000},
    NovaShard:{rarity:"Exquisite",value:26,color:"#ff6ec7",symbol:"NS",spawnMsg:"Your heart skips a beat!",exact:12000000},
    Celestium:{rarity:"Exquisite",value:27,color:"#7c4dff",symbol:"CE",spawnMsg:"Your heart skips a beat!",exact:15000000},
    Astralite:{rarity:"Exquisite",value:28,color:"#00e5ff",symbol:"AS",spawnMsg:"Your heart skips a beat!",exact:18000000},
    Luminite:{rarity:"Exquisite",value:29,color:"#ffd740",symbol:"LU",spawnMsg:"Your heart skips a beat!",exact:21000000},
    EclipseCore:{rarity:"Exquisite",value:30,color:"#ff1744",symbol:"EC",spawnMsg:"Your heart skips a beat!",exact:24000000},
    OblivionShard:{rarity:"Enigmatic",value:31,color:"#263238",symbol:"OS",spawnMsg:"Your vision begins to blur!",exact:85000000},
    PhantomCrystal:{rarity:"Enigmatic",value:32,color:"#37474f",symbol:"PC",spawnMsg:"Your vision begins to blur!",exact:95000000},
    AbyssalCore:{rarity:"Unfathomable",value:33,color:"#4a148c",symbol:"AC",spawnMsg:"A bottomless abyss opens beneath your feet...",exact:150000000},
    DarkMatter:{rarity:"Unfathomable",value:34,color:"#1a237e",symbol:"DM",spawnMsg:"Gravity distorts violently around the Dark Matter!",exact:220000000},
    CosmicRelic:{rarity:"Otherworldly",value:35,color:"#ff6867",symbol:"CR",symbolColor:"#00ffff",spawnMsg:"The fabric of existence tears apart!",exact:750000000},
    Singularity:{rarity:"Imaginary",value:36,color:"#000000",symbol:"Œ©",symbolColor:"#ff00ff",spawnMsg:"Time stops. Space collapses. You found the impossible.",exact:2000000000},
    AlterDemon:{rarity:"Divine",value:37,color:"#000000",symbol:"AD",symbolColor:"#ff0000",spawnMsg:"Alters demon is here to catch you",exact:1000000},
    Veritcal:{rarity:"Imaginary",value:38,color:"#90D5FF",symbol:"Vert",symbolColor:"#000000",spawnMsg:"You shouldn't dig straight down",exact:4444444444},
    Zanacharium:{rarity:"Zenith",value:39,color:"#DF03FC",symbol:"?",symbolColor:"#000000",spawnMsg:"An unusual force materializes upon the surface of this world...",exact:68750000000},
    Chronovexium:{rarity:"Zenith",value:40,color:"#00F0FF",symbol:"‚è≥",symbolColor:"#000000",spawnMsg:"Time fractures as Chronovexium emerges from the continuum...",exact:125000000000},
    Aetherion:{rarity:"Zenith",value:41,color:"#FFD700",symbol:"‚ú∂",symbolColor:"#000000",spawnMsg:"The heavens shimmer as Aetherion descends into existence...",exact:350000000000},
    Paradoxium:{rarity:"Eternal",value:42,color:"#6A00FF",symbol:"Œ®",symbolColor:"#FFFFFF",spawnMsg:"Reality twists into an impossible shape as Paradoxium manifests...",exact:1500000000000},
    GenesisFragment:{rarity:"Eternal",value:43,color:"#FFFFFF",symbol:"‚ú¶",symbolColor:"#000000",spawnMsg:"A spark of creation ignites as the Genesis Fragment forms...",exact:5000000000000},
    BlueTheFR:{rarity:"Eternal",value:44,color:"#00FBFF",symbol:"Blue",symbolColor:"#FFFFFF",spawnMsg:"You meet the creator...",exact:10000000000000},
    Nebulium:{rarity:"Transcendent", value:45, color:"#76ff03", symbol:"N", spawnMsg:"You hear a ringing!", exact:26000000},
    Stellarium:{rarity:"Transcendent", value:46, color:"#00bcd4", symbol:"St", spawnMsg:"You hear a ringing!", exact:28000000},
    Lunarium:{rarity:"Transcendent", value:47, color:"#ffeb3b", symbol:"L", spawnMsg:"You hear a ringing!", exact:30000000},
    Solarium:{rarity:"Transcendent", value:48, color:"#ff9800", symbol:"So", spawnMsg:"You hear a ringing!", exact:32000000},
    Aetherium:{rarity:"Transcendent", value:49, color:"#8bc34a", symbol:"Ae", spawnMsg:"You hear a ringing!", exact:35000000},
    Chronium:{rarity:"Transcendent", value:50, color:"#00ffff", symbol:"Ch", spawnMsg:"You hear a ringing!", exact:38000000},
    Quantumite:{rarity:"Transcendent", value:51, color:"#2196f3", symbol:"Q", spawnMsg:"You hear a ringing!", exact:40000000},
    Hyperion:{rarity:"Transcendent", value:52, color:"#ff4081", symbol:"Hy", spawnMsg:"You hear a ringing!", exact:45000000},
    Vortexium:{rarity:"Transcendent", value:53, color:"#9c27b0", symbol:"Vx", spawnMsg:"You hear a ringing!", exact:52500000},
    Ecliptium:{rarity:"Transcendent", value:54, color:"#ff5722", symbol:"Ec", spawnMsg:"You hear a ringing!", exact:55000000},
    OblivionCore:{rarity:"Enigmatic", value:55, color:"#37474f", symbol:"OC", spawnMsg:"Your vision begins to blur!", exact:90000000},
    Abyssion:{rarity:"Otherworldly", value:56, color:"#8b0000", symbol:"Ab", exact:525000000, spawnMsg:"The world trembles as Abyssion emerges!"},
    Eternium:{rarity:"Otherworldly", value:57, color:"#ff1744", symbol:"Et", exact:550000000, spawnMsg:"Eternium pulses with unimaginable energy!"},
    Voidessence:{rarity:"Otherworldly", value:58, color:"#6a1b9a", symbol:"Ve", exact:600000000, spawnMsg:"Voidessence warps the very fabric of existence!"},
    Cosmosite:{rarity:"Otherworldly", value:59, color:"#ff6867", symbol:"Co", exact:650000000, spawnMsg:"The cosmos quivers as Cosmosite forms!"},
    Singulite:{rarity:"Otherworldly", value:60, color:"#00ffff", symbol:"Si", exact:700000000, spawnMsg:"Singulite bends space and time around you!"},
    ZergHunter:{rarity:"Unfathomable", value:61, color:"#FF1300", symbol:"ZH", exact:100000000, spawnMsg:"Survive‚Ä¶ or become meat"},
    VoidShard:{rarity:"Mythical",value:62,color:"#00e5ff",symbol:"VS",exact:75000},
    FrostWraith:{rarity:"Exotic",value:63,color:"#00b0ff",symbol:"FW",spawnMsg:"A chill goes down your spine!",exact:750000},
    SoulGlacier:{rarity:"Exotic",value:64,color:"#9c27b0",symbol:"SG",spawnMsg:"A chill goes down your spine!",exact:2000000},
    EmberPhantom:{rarity:"Exotic",value:65,color:"#ff9800",symbol:"EP",spawnMsg:"A chill goes down your spine!",exact:3000000},
    CrimsonEclipse:{rarity:"Exotic",value:66,color:"#f44336",symbol:"CE",spawnMsg:"A chill goes down your spine!",exact:4000000},
    AbyssalSingularity:{rarity:"Unfathomable",value:67,color:"#000000",symbol:"AS",spawnMsg:"Reality distorts around you...",exact:200000000},
    AstralCataclysm:{rarity:"Otherworldly", value:68,color:"#1a237e",symbol:"AC",spawnMsg:"The sky fractures with alien light!",exact:300000000},
    VoidRequiem:{rarity:"Otherworldly", value:69,color:"#4a148c",symbol:"VR",spawnMsg:"A silent hymn echoes from beyond existence...",exact:400000000},
    EternalParadox:{rarity:"Otherworldly", value:70,color:"#b71c1c",symbol:"EPX",spawnMsg:"Time collapses. Something impossible has awakened.",exact:800000000},
    EclipseShard:{rarity:"Enigmatic",value:71,color:"#1c1c1c",symbol:"ES",spawnMsg:"Your vision begins to blur!",exact:60000000},
    ShadowFragment:{rarity:"Enigmatic",value:72,color:"#2f2f2f",symbol:"SF",spawnMsg:"Your vision begins to blur!",exact:61230000},
    TwilightGem:{rarity:"Enigmatic",value:73,color:"#512da8",symbol:"TG",spawnMsg:"Your vision begins to blur!",exact:63000000},
    OblivionStone:{rarity:"Enigmatic",value:74,color:"#263238",symbol:"OS",spawnMsg:"Your vision begins to blur!",exact:70000000},
    NightCore:{rarity:"Enigmatic",value:75,color:"#ff1744",symbol:"NC",spawnMsg:"Your vision begins to blur!",exact:77000000},
    SpecterGem:{rarity:"Enigmatic",value:76,color:"#37474f",symbol:"SG",spawnMsg:"Your vision begins to blur!",exact:81000000},
    AbyssGem:{rarity:"Enigmatic",value:77,color:"#4a148c",symbol:"AG",spawnMsg:"Your vision begins to blur!",exact:99999998},
    FrostShard:{rarity:"Unfathomable",value:78,color:"#00dfff",symbol:"FS",spawnMsg:"A shard of eternal frost crystallizes before your eyes!",exact:120000000},
    GlacierHeart:{rarity:"Unfathomable",value:79,color:"#00aaff",symbol:"GH",spawnMsg:"The heart of a glacier pulses, freezing everything around it!",exact:140000000},
    IceboundCore:{rarity:"Unfathomable",value:80,color:"#88eeff",symbol:"IC",spawnMsg:"IceboundCore emerges, encasing reality in glacial chains!",exact:180000000},
};

const rarityColors = {
    Exotic: "#ffeb3b",
    Exquisite: "#00ff00",
    Transcendent: "#2196f3",
    Enigmatic: "#fff176",
    Unfathomable: "#0d47a1",
    Otherworldly: "#8b0000",
    Imaginary: "#ffffe0",
	Divine: "#ff0000",
	Zenith: "#DF03FC",
	Eternal: "#00FBFF",
};

// Pickaxes
const pickaxeData = {
    T0:{desc:"Starter pickaxe, mines 1 block.", cost:{}},
    T1:{desc:"25% chance to mine an adjacent block.", cost:{Stone:50, Coal:25}},
    T2:{desc:"Mines 2 blocks horizontally.", cost:{Iron:30, Emerald:10}},
    T3:{desc:"Mines in a cross shape.", cost:{Iron:50, Ruby:15, Emerald:10}},
    T4:{desc:"do a 3x3 explosion.", cost:{Ruby:20, Sapphire:10, Emerald:5}},
    T5:{desc:"5-layer 3x3 mine. 50% chance to spawn a new 50K+ ore when mined.", cost:{Ruby:50, Sapphire:25, Topaz:20, Diamond:5, Void:3, Gold:1}},
	T6:{desc: "7-layer 3x3 mine. 75% chance to spawn a new 10K+ ore, 25% chance to upgrade a random block. Gives 5x luck boost.", cost: {Tera: 1, TeraPlus: 1, Smiley: 5}}
};

// Gear
const gearData = {
    T1:{desc:"Chance to explode 3x3 area.",cost:{Iron:25, Coal:20}},
    T2:{desc:"+5% chance to duplicate ore.",cost:{Iron:30, Coal:15}},
    T3:{desc:"25% chance for 3x ore, 50% chance for 2x ore.",cost:{Emerald:10, Iron:50}},
    T4:{desc:"Give a 2x Luck boost",cost:{Ruby:5, Emerald:10}},
    T5:{desc:"Give a 10x Luck boost and as a 50% to dupliate ore 2x 25% 3x and 25% for 5x",cost:{Emerald:5, Ruby:5, Sapphire:1, Void:1, Giga:1}},
	T6:{ desc: "Give a 25x Luck boost and 25% to upgrade a mined ore by 1 tier",cost: {Peta:1, Tera:1, AlterDemon:2}}
};

// Artefacts
const artefactData = {
    1:{desc:"Mines 1 block every 5s",cost:{Stone:10},interval:5000,blocks:1},
    2:{desc:"Mines 2 block every 4s",cost:{Coal:10},interval:4000,blocks:2},
    3:{desc:"Mines 3 block every 1s",cost:{Emerald:25},interval:1000,blocks:3},
    4:{desc:"Mines 5 blocks every 1s",cost:{Void:20},interval:1000,blocks:5},
    5:{desc:"Mines 25 blocks every 1s",cost:{HyperMega:1},interval:1000,blocks:25},
	6:{desc:"Mines 30 blocks every 1s",cost:{Tera:1},interval:1000,blocks:30},
	7:{desc:"Mines 40 blocks every 1s",cost:{TeraPlus:1},interval:1000,blocks:40},
	8:{desc:"Mines 50 blocks every 1s",cost:{PetaPlus1:1},interval:1000,blocks:50},
	9:{desc:"Mines 60 blocks every 1s",cost:{Celestium:1},interval:1000,blocks:60},
	10:{desc:"Mines 80 blocks every 1s",cost:{Nebulium:1},interval:1000,blocks:80},
};

// Luck Artefacts
const luckArtefactData = {};
for(let lvl=1; lvl<=50; lvl++){
    luckArtefactData[lvl] = {desc: `+${lvl*10}% luck for ores ‚â• 1K`, cost:{Emerald: 10*lvl}};
}

// Grid
function generateGrid(){
    grid = [];
    for(let y=0;y<GRID;y++){
        let row=[];
        for(let x=0;x<GRID;x++){
            row.push(randomOre());
        }
        grid.push(row);
    }
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.font="40px Arial";
    for(let y=0;y<GRID;y++){
        for(let x=0;x<GRID;x++){
            let ore=grid[y][x];
            let data = oreData[ore];
            ctx.fillStyle = data.color;
            ctx.fillRect(x*SIZE,y*SIZE,SIZE-2,SIZE-2);
            if(data.symbol){
                ctx.fillStyle = data.symbolColor || "#fff";
                ctx.fillText(data.symbol,x*SIZE + SIZE/2, y*SIZE + SIZE/2);
            }
        }
    }
}

function randomOre(){
    const ores = Object.keys(oreData);

    for(let i=ores.length-1;i>=0;i--){
        const ore=ores[i];
        const data=oreData[ore];

        if(Math.random() < 1/data.exact){

            // üî• IF RARE ORE SPAWNS ‚Üí TRIGGER SOUND + MESSAGE
            if(data.exact >= 250000 && data.spawnMsg){
                setTimeout(() => playSpawnSound(ore), 50);
            }

            return ore;
        }
    }

    return "Stone";
}


function randomHighTierOre(){
    const ores = Object.keys(oreData).filter(o=>oreData[o].exact>=50000);

    for(let i=ores.length-1;i>=0;i--){
        const ore=ores[i];

        if(Math.random() < (1 / (oreData[ore].exact * 50))) {

            if(oreData[ore].exact >= 250000 && oreData[ore].spawnMsg){
                setTimeout(() => playSpawnSound(ore), 50);
            }

            return ore;
        }
    }

    return ores[0];
}

// Mining
canvas.addEventListener("click",e=>{
    let rect=canvas.getBoundingClientRect();
    let x=Math.floor((e.clientX-rect.left)/SIZE);
    let y=Math.floor((e.clientY-rect.top)/SIZE);
    mineBlocks(x,y,true);
});

let lastT6Upgrade = 0; // global variable to track T6 30s cooldown

function mineBlocks(x, y, manual=false){
    if (spawnLock) return;
    if(!grid[y] || !grid[y][x]) return;
    let ore = grid[y][x];
    let data = oreData[ore];
    let targets = [[x, y]];

    // Pickaxe patterns
    if(equippedPickaxe==="T1" && Math.random()<0.25){
        const dirs=[[1,0],[-1,0],[0,1],[0,-1]];
        const [dx,dy]=dirs[Math.floor(Math.random()*dirs.length)];
        targets.push([x+dx,y+dy]);
    }
    if(equippedPickaxe==="T2") targets=[[x,y],[x+1,y],[x-1,y]];
    if(equippedPickaxe==="T3") targets=[[x,y],[x+1,y],[x-1,y],[x,y+1],[x,y-1]];
    if(equippedPickaxe==="T4"){
        targets=[];
        for(let dx=-1;dx<=1;dx++) for(let dy=-1;dy<=1;dy++) targets.push([x+dx,y+dy]);
    }
    if(equippedPickaxe==="T5"){
        targets=[];
        for(let layer=0;layer<5;layer++)
            for(let dx=-1;dx<=1;dx++) for(let dy=-1;dy<=1;dy++) targets.push([x+dx,y+dy]);
    }

    // T6 deep mine + high-tier spawn
	if(equippedPickaxe==="T6"){
		targets=[];
		for(let layer=0; layer<7; layer++){
			for(let dx=-1; dx<=1; dx++){
				for(let dy=-1; dy<=1; dy++){
					let tx = x + dx;
					let ty = y + dy + layer;
					targets.push([tx, ty]);
				}
			}
	}

    // Only spawn/upgrade if mined block is ‚â•10K
    if(data.exact >= 10000 && !waitingForManualHighOre){
        const now = Date.now();
        const canUpgrade = (now - lastT6Upgrade) >= 30000;

        if(Math.random() < 0.75){
            let ux = Math.floor(Math.random()*GRID);
            let uy = Math.floor(Math.random()*GRID);

            // Pick a valid high-tier ore
            const highTierOres = Object.keys(oreData)
                .filter(o => oreData[o].exact >= 10000 && oreData[o].exact <= 100000000);

            if(highTierOres.length === 0) return; // safety check

            let newOre = highTierOres[Math.floor(Math.random() * highTierOres.length)];
            let upgradeCount = 0;

            // Apply upgrade if cooldown passed
            if(canUpgrade && Math.random() < 0.25){
                let oreToUpgrade = newOre;
                while(Math.random() < 0.25){
                    const upgradable = Object.keys(oreData)
                        .filter(o => oreData[o].exact > oreData[oreToUpgrade].exact &&
                                     oreData[o].exact <= 100000000);
                    if(upgradable.length === 0) break;
                    oreToUpgrade = upgradable[Math.floor(Math.random() * upgradable.length)];
                    upgradeCount++;
                }
                newOre = oreToUpgrade;
                lastT6Upgrade = now;
            }

            grid[uy][ux] = newOre;

            // Trigger spawn message
            if(oreData[newOre].spawnMsg){
                setTimeout(() => playSpawnSound(newOre), 50);
            }
        }
    }
}


    // Gear and pickaxe bonuses
    let explosionChance=0, luckChance=0, tripleChance=0, doubleChance=0, luckMultiplier=1; let upgradeChance = 0;
    if(equippedPickaxe==="T4") explosionChance+=0.1;
    if(equippedPickaxe==="T5") explosionChance+=0.5;
    if(equippedPickaxe==="T6") luckMultiplier *= 5;

    equippedGears.forEach(g=>{
        switch(g){
            case "T1": explosionChance+=0.1; break;
            case "T2": luckChance+=0.05; break;
            case "T3": tripleChance+=0.25; doubleChance+=0.5; break;
            case "T4": luckMultiplier*=2; break;
            case "T5": luckMultiplier*=10; break;
			case "T6": luckMultiplier *= 25; upgradeChance = 0.25; break;
		}
	});

    // Mine targets
    targets.forEach(([tx, ty]) => {
		if (tx < 0 || ty < 0 || ty >= GRID || tx >= GRID) return;

		let ore2 = grid[ty][tx]; // the ore in this cell
		let data2 = oreData[ore2];
		let count = 1;

// Apply luck / triple / double first
if (Math.random() < luckChance * luckMultiplier) count++;
if (Math.random() < tripleChance) count *= 3;
else if (Math.random() < doubleChance) count *= 2;

// Gear T5 bonus
if (equippedGears.includes("T5")) {
    let roll = Math.random();
    if (roll < 0.25) count *= 5;
    else if (roll < 0.5) count *= 3;
    else count *= 2;
}

// Luck artefact bonus
if (luckArtefactLevel > 0 && data2.exact >= 1000) {
    if (Math.random() < 0.1 * luckArtefactLevel) count++;
}

// Upgrade chance (T6 gear)
if (upgradeChance > 0 && Math.random() < upgradeChance) {
    const upgradable = Object.keys(oreData)
        .filter(o => oreData[o].exact > data2.exact)
        .sort((a, b) => oreData[a].exact - oreData[b].exact);

    if (upgradable.length > 0) {
        ore2 = upgradable[0]; // upgrade ore
    }
}

// ‚úÖ Now add to inventory
if (!inventory[ore2]) inventory[ore2] = 0;
inventory[ore2] += count;
updateRecentFind(ore2, count);


		// Replace mined block
		grid[ty][tx] = randomOre();
	});


    if(manual && waitingForManualHighOre){
        let centerOre = grid[Math.floor(GRID/2)][Math.floor(GRID/2)];
        if(oreData[centerOre].exact < 250000){
            waitingForManualHighOre = false;
            startArtefact();
        }
    }

    updateCounters();
    updateUI();
    draw();
}


	function updateCounters() {
    totalBlocksMined = 0;
    globalBlocksMined = 0;

    for (let ore in inventory) {
        const count = inventory[ore] || 0;
		totalBlocksMined += count;
		if (oreData[ore].exact >= 100000000) globalBlocksMined += count;
    }

    document.getElementById("totalMined").innerText = `Total Mined: ${formatNumber(totalBlocksMined)}`;
    document.getElementById("globalMined").innerText = `Global Mined: ${formatNumber(globalBlocksMined)}`;
}


// Auto-Miner
function startArtefact(){
    if(artefactInterval) clearInterval(artefactInterval);
    if(artefactLevel===0) return;
    let a=artefactData[artefactLevel];
    artefactInterval=setInterval(()=>{
        for(let i=0;i<a.blocks;i++) mineBlocks(1,1,false);
    },a.interval);
}
// UI Helpers
function costToString(cost) {
    return Object.entries(cost).map(([o, a]) => `${a} ${o}`).join(", ");
}
function canAfford(cost) {
    for (let o in cost) if ((inventory[o] || 0) < cost[o]) return false;
    return true;
}
function spendCost(cost) {
    for (let o in cost) inventory[o] -= cost[o];
}

	function updateUI() {
    const invDiv = document.getElementById("inventory");
    invDiv.innerHTML = "";

    Object.keys(inventory)
        .sort((a, b) => sortRarestFirst ? oreData[b].exact - oreData[a].exact : oreData[a].exact - oreData[b].exact)
        .forEach(o => {
            const r = oreData[o];
            const count = inventory[o] || 0;

            const div = document.createElement("div");
            div.style.cursor = "pointer";
            div.style.background = r.color;
            div.style.color = r.symbolColor || "#fff";
            div.style.border = "2px solid #000";
            div.style.padding = "2px";
            div.style.marginBottom = "2px";
            div.innerHTML = `${o} (${r.rarity}) - ${formatNumber(count)}`;
            
            // Click to show ore viewer
            div.onclick = () => showOreViewer(o);

            invDiv.appendChild(div);
        });

    // Pickaxes, Gears, Artefacts, Luck Artefacts
    const pUI = document.getElementById("pickaxeUI");
    pUI.innerHTML = "";
    for (let name in pickaxeData) createPickaxeButton(name, pickaxeData[name].desc, pickaxeData[name].cost);

    const gUI = document.getElementById("gearUI");
    gUI.innerHTML = "";
    for (let name in gearData) createGearButton(name, gearData[name].desc, gearData[name].cost);

    updateArtefactUI();
    updateLuckArtefactUI();
    updateOreIndex();
}




	function updateOreIndex() {
    const indexDiv = document.getElementById("oreIndex");
    const allOres = Object.keys(oreData);

    // Count how many ores you actually own (>0)
    const discoveredOres = allOres.filter(ore => (inventory[ore] || 0) > 0).length;

    indexDiv.innerHTML = `<h3>Ore Index (${discoveredOres} / ${allOres.length})</h3>`;

    allOres
        .sort((a, b) => sortRarestFirst ? oreData[b].exact - oreData[a].exact : oreData[a].exact - oreData[b].exact)
        .forEach(ore => {
            const r = oreData[ore];
            const owned = (inventory[ore] || 0) > 0; // ‚úÖ fixed

            const div = document.createElement("div");
            div.style.color = owned ? "lime" : "red"; // green if owned, red if not
            div.style.fontSize = "13px";
            div.style.padding = "2px 4px";
            div.style.marginBottom = "1px";
            div.style.cursor = "pointer";

            div.innerHTML = `${ore} (${r.rarity}) - 1 in ${formatNumber(r.exact)}`;
            indexDiv.appendChild(div);
        });
}


// PICKAXE BUTTON
function createPickaxeButton(name, desc, cost) {
    const container = document.createElement("div");
    container.style.marginBottom = "6px";

    const owned = ownedPickaxes.includes(name);
    const eq = (equippedPickaxe === name);

    const btn = document.createElement("button");
    btn.innerText = owned ? name + (eq ? " (Equipped)" : " (Owned)") : "Buy " + name;

    btn.onclick = owned
        ? () => { equippedPickaxe = name; updateUI(); }
        : () => {
            if (canAfford(cost)) {
                spendCost(cost);
                ownedPickaxes.push(name);
                updateUI();
            } else alert("Not enough resources");
        };

    container.appendChild(btn);

    const div = document.createElement("div");
    div.style.fontSize = "12px";

    if (!owned) {
        div.innerHTML = desc + "<br><strong>Cost:</strong> " + costToString(cost);
        if (canAfford(cost)) div.style.color = "lime"; // GREEN if affordable
    } else {
        div.innerHTML = desc;
    }

    container.appendChild(div);
    document.getElementById("pickaxeUI").appendChild(container);
}

// GEAR BUTTON
function createGearButton(name, desc, cost) {
    const container = document.createElement("div");
    container.style.marginBottom = "6px";

    const owned = ownedGears.includes(name);
    const eq = equippedGears.includes(name);

    const btn = document.createElement("button");
    btn.innerText = owned ? name + (eq ? " (Equipped)" : " (Owned)") : "Buy " + name;

    btn.onclick = owned
        ? () => equipGear(name)
        : () => {
            if (canAfford(cost)) {
                spendCost(cost);
                ownedGears.push(name);
                updateUI();
            } else alert("Not enough resources");
        };

    container.appendChild(btn);

    const div = document.createElement("div");
    div.style.fontSize = "12px";

    if (!owned) {
        div.innerHTML = desc + "<br><strong>Cost:</strong> " + costToString(cost);
        if (canAfford(cost)) div.style.color = "lime"; // GREEN if affordable
    } else {
        div.innerHTML = desc;
    }

    container.appendChild(div);
    document.getElementById("gearUI").appendChild(container);
}

// Equip Gear
function equipGear(name) {
    if (!equippedGears.includes(name)) {
        if (equippedGears.length >= 2) equippedGears.shift();
        equippedGears.push(name);
    } else equippedGears = equippedGears.filter(g => g !== name);
    updateUI();
}

	// ARTEFACT UI
function updateArtefactUI() {
    const aUI = document.getElementById("artefactUI");
    aUI.innerHTML = "";

    const maxLevel = Object.keys(artefactData).length;

    for (let lvl = 1; lvl <= maxLevel; lvl++) {
        const container = document.createElement("div");
        container.style.marginBottom = "6px";

        const a = artefactData[lvl];
        const btn = document.createElement("button");

        if (lvl < artefactLevel) {
            // Already purchased but NOT equipped
            btn.innerText = `Level ${lvl} (Unlocked)`;
            btn.disabled = true;
        } else if (lvl === artefactLevel) {
            // Currently equipped
            btn.innerText = `Level ${lvl} (Equipped)`;
            btn.disabled = true;
        } else if (lvl === artefactLevel + 1) {
            // Next level available to buy
            btn.innerText = `Buy Level ${lvl}`;
            btn.onclick = () => {
                if (canAfford(a.cost)) {
                    spendCost(a.cost);

                    // Update level
                    artefactLevel = lvl;

                    // Auto-equip new level
                    if (artefactInterval) clearInterval(artefactInterval);
                    startArtefact();

                    // Update UI to show new level equipped
                    updateUI();
                } else {
                    alert("Not enough resources");
                }
            };
        } else {
            // Future locked levels
            btn.innerText = `Locked`;
            btn.disabled = true;
        }

        container.appendChild(btn);

        const div = document.createElement("div");
        div.style.fontSize = "12px";

        if (lvl === artefactLevel + 1) {
            div.innerHTML = a.desc + "<br><strong>Cost:</strong> " + costToString(a.cost);
            if (canAfford(a.cost)) div.style.color = "lime"; // show green if affordable
        } else {
            div.innerHTML = a.desc;
        }

        container.appendChild(div);
        aUI.appendChild(container);
    }
}




function updateLuckArtefactUI() {
    const lUI = document.getElementById("luckArtefactUI");
    lUI.innerHTML = "";

    const maxLevel = Object.keys(luckArtefactData).length;

    for (let lvl = 1; lvl <= maxLevel; lvl++) {
        const container = document.createElement("div");
        container.style.marginBottom = "6px";

        const data = luckArtefactData[lvl];
        const btn = document.createElement("button");

        if (lvl < luckArtefactLevel) {
            // Already purchased but NOT equipped
            btn.innerText = `Level ${lvl} (Unlocked)`;
            btn.disabled = true;
        } else if (lvl === luckArtefactLevel) {
            // Currently equipped
            btn.innerText = `Level ${lvl} (Equipped)`;
            btn.disabled = true;
        } else if (lvl === luckArtefactLevel + 1) {
            // Next level available to buy
            btn.innerText = `Buy Level ${lvl}`;
            btn.onclick = () => {
                if (canAfford(data.cost)) {
                    spendCost(data.cost);

                    // Update level and auto-equip
                    luckArtefactLevel = lvl;

                    updateUI();
                } else {
                    alert("Not enough resources");
                }
            };
        } else {
            // Locked future levels
            btn.innerText = `Locked`;
            btn.disabled = true;
        }

        container.appendChild(btn);

        const div = document.createElement("div");
        div.style.fontSize = "12px";

        if (lvl === luckArtefactLevel + 1) {
            div.innerHTML = data.desc + "<br><strong>Cost:</strong> " + costToString(data.cost);
            if (canAfford(data.cost)) div.style.color = "lime";
        } else {
            div.innerHTML = data.desc;
        }

        container.appendChild(div);
        lUI.appendChild(container);
    }
}




// Ore Viewer
const oreViewer = document.getElementById("oreViewer");
const oreBlock = document.getElementById("oreBlock");
const oreName = document.getElementById("oreName");
const oreRarity = document.getElementById("oreRarity");
const replaySpawn = document.getElementById("replaySpawn");
let lastSpawnOre = null;

function showOreViewer(ore) {
    if (lastSpawnOre === ore && oreViewer.style.display === "block") {
        oreViewer.style.display = "none"; // hide if same ore clicked
        lastSpawnOre = null;
        return;
    }

    const data = oreData[ore];
    oreViewer.style.display = "block";
    oreBlock.style.background = data.color;
    oreBlock.innerText = data.symbol || "";
    oreBlock.style.color = data.symbolColor || "#fff";

    oreName.innerText = `${ore} (${data.rarity})`;
    oreRarity.innerText = `1 in ${formatNumber(data.exact)}`;

    lastSpawnOre = ore; // store for replay
}




// Replay button
replaySpawn.onclick = () => {
    if (lastSpawnOre) playSpawnSound(lastSpawnOre);
};

function saveGame(showAlert = true) {
    localStorage.setItem("MiningRNGSimulator", JSON.stringify({
        inventory,
        ownedPickaxes,
        equippedPickaxe,
        ownedGears,
        equippedGears,
        artefactLevel,
        luckArtefactLevel,
        pauseOnChill,
        waitingForManualHighOre
    }));

    if (showAlert) {
        alert("Game saved!");
    } else {
        console.log("Game auto-saved at " + new Date().toLocaleTimeString());
    }
}

function loadGame() {
    const save = localStorage.getItem("MiningRNGSimulator");
    if (save) {
        const data = JSON.parse(save);
        inventory = data.inventory || {};
        ownedPickaxes = data.ownedPickaxes || ["T0"];
        equippedPickaxe = data.equippedPickaxe || "T0";
        ownedGears = data.ownedGears || [];
        equippedGears = data.equippedGears || [];
        artefactLevel = data.artefactLevel || 0;
        luckArtefactLevel = data.luckArtefactLevel || 0;
        pauseOnChill = data.pauseOnChill || false;
        waitingForManualHighOre = data.waitingForManualHighOre || false;
        currentVolumeIndex = data.currentVolumeIndex ?? 0;

    } else {
        inventory = {};
        currentVolumeIndex = 0;
    }
}
function resetGame() { 
    localStorage.removeItem("MiningRNGSimulator"); 
    location.reload(); 
}
loadGame();
document.querySelectorAll("audio").forEach(a => {
    a.volume = volumeLevels[currentVolumeIndex];
});
generateGrid();
updateUI();
draw();
startArtefact();
setInterval(() => {
    saveGame(false); // false = do NOT show alert
}, 300000); // 300000ms = 5 minutes

</script>
</body>
</html>